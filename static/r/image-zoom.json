{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "image-zoom",
	"title": "Image Zoom",
	"type": "registry:ui",
	"description": "A component to zoom into images in an overlay.",
	"dependencies": [
		"lucide-svelte@^0.554.0"
	],
	"registryDependencies": [
		"button"
	],
	"files": [
		{
			"content": "<script lang=\"ts\">\r\n    import { writable } from \"svelte/store\";\r\n    import { setImageZoomContext, type ZoomImageData } from \"./ctx\";\r\n    import { fade } from \"svelte/transition\";\r\n    import {onMount, onDestroy, type Snippet} from \"svelte\";\r\n    import { Button } from \"$lib/components/ui/button\";\r\n    import { X, ChevronLeft, ChevronRight } from \"lucide-svelte\"; // Added navigation icons\r\n    import { cn } from \"$UTILS$\";\r\n\r\n    let {\r\n        class: className,\r\n        children\r\n    } : {\r\n        class?: string;\r\n        children?: Snippet;\r\n    }= $props();\r\n\r\n    // Internal states\r\n    const registeredImagesStore = writable<ZoomImageData[]>([]); // All images registered by triggers\r\n    const currentImageIndexStore = writable<number | null>(null); // Index of the currently zoomed image\r\n    const openStore = writable(false);\r\n\r\n    // Reactive derived states from stores\r\n    let registeredImages = $state<ZoomImageData[]>([]);\r\n    let currentImageIndex = $state<number | null>(null);\r\n    let isOpen = $state(false);\r\n\r\n    // Sync internal states with stores\r\n    $effect(() => {\r\n        registeredImages = $registeredImagesStore;\r\n        currentImageIndex = $currentImageIndexStore;\r\n        isOpen = $openStore;\r\n    });\r\n\r\n    // Derived properties for current image and navigation\r\n    const currentImageData = $derived(\r\n        currentImageIndex !== null ? registeredImages[currentImageIndex] : null\r\n    );\r\n    const hasMultipleImages = $derived(registeredImages.length > 1);\r\n    const hasPrevious = $derived(currentImageIndex !== null && currentImageIndex > 0);\r\n    const hasNext = $derived(currentImageIndex !== null && currentImageIndex < registeredImages.length - 1);\r\n\r\n    // --- Context Functions ---\r\n    function registerImage(imageData: Omit<ZoomImageData, 'index'>) {\r\n        const index = $registeredImagesStore.length;\r\n        $registeredImagesStore = [...$registeredImagesStore, { ...imageData, index }];\r\n        return index;\r\n    }\r\n\r\n    function openImage(index: number) {\r\n        $currentImageIndexStore = index;\r\n        $openStore = true;\r\n    }\r\n\r\n    function nextImage() {\r\n        if (currentImageIndex !== null && hasNext) {\r\n            $currentImageIndexStore = currentImageIndex + 1;\r\n        }\r\n    }\r\n\r\n    function prevImage() {\r\n        if (currentImageIndex !== null && hasPrevious) {\r\n            $currentImageIndexStore = currentImageIndex - 1;\r\n        }\r\n    }\r\n\r\n    function closeZoom() {\r\n        $openStore = false;\r\n        $currentImageIndexStore = null;\r\n        // Optionally clear registered images if Root is remounted often\r\n        // but typically you keep them if Root stays mounted\r\n    }\r\n\r\n    // Provide context to children\r\n    setImageZoomContext({\r\n        registeredImages: registeredImagesStore,\r\n        currentImageIndex: currentImageIndexStore,\r\n        open: openStore,\r\n        registerImage,\r\n        openImage,\r\n        nextImage,\r\n        prevImage\r\n    });\r\n\r\n    // Handle Escape key\r\n    function handleKeydown(event: KeyboardEvent) {\r\n        if (!isOpen) return;\r\n        if (event.key === 'Escape') closeZoom();\r\n        if (event.key === 'ArrowLeft') prevImage();\r\n        if (event.key === 'ArrowRight') nextImage();\r\n    }\r\n</script>\r\n\r\n<svelte:window onkeydown={handleKeydown} />\r\n\r\n{#if isOpen && currentImageData}\r\n    <div\r\n            class={cn(\r\n            \"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90\",\r\n            className\r\n        )}\r\n            transition:fade={{ duration: 150 }}\r\n            aria-modal=\"true\"\r\n            role=\"dialog\"\r\n            tabindex=\"-1\"\r\n    >\r\n        <!-- Background click to close -->\r\n        <div\r\n                class=\"absolute inset-0\"\r\n                onclick={closeZoom}\r\n                aria-label=\"Close\"\r\n                role=\"button\"\r\n        ></div>\r\n\r\n        <!-- Image Container -->\r\n        <div class=\"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center pointer-events-none\">\r\n            <img\r\n                    src={currentImageData.src}\r\n                    alt={currentImageData.alt}\r\n                    class=\"block max-w-full max-h-full object-contain pointer-events-auto\"\r\n                    transition:fade={{ duration: 300, delay: 50 }}\r\n            />\r\n        </div>\r\n\r\n        <!-- Gallery Navigation Buttons -->\r\n        {#if hasMultipleImages}\r\n            <!-- Previous Button -->\r\n            <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    class=\"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 hover:bg-primary cursor-pointer pointer-events-auto disabled:opacity-30 disabled:pointer-events-none\"\r\n                    onclick={prevImage}\r\n                    disabled={!hasPrevious}\r\n                    aria-label=\"Previous image\"\r\n            >\r\n                <ChevronLeft class=\"h-8 w-8\" />\r\n            </Button>\r\n\r\n            <!-- Next Button -->\r\n            <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    class=\"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 hover:bg-primary cursor-pointer pointer-events-auto disabled:opacity-30 disabled:pointer-events-none\"\r\n                    onclick={nextImage}\r\n                    disabled={!hasNext}\r\n                    aria-label=\"Next image\"\r\n            >\r\n                <ChevronRight class=\"h-8 w-8\" />\r\n            </Button>\r\n        {/if}\r\n\r\n        <!-- Close Button -->\r\n        <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                class=\"absolute top-4 right-4 pointer-events-auto text-white hover:text-gray-300 cursor-pointer hover:bg-primary\"\r\n                onclick={closeZoom}\r\n                aria-label=\"Close zoomed image\"\r\n        >\r\n            <X class=\"h-6 w-6\" />\r\n        </Button>\r\n    </div>\r\n{/if}\r\n\r\n{@render children()}",
			"type": "registry:ui",
			"target": "image-zoom/image-zoom.svelte"
		},
		{
			"content": "<script lang=\"ts\">\r\n    import { getImageZoomContext } from \"./ctx\";\r\n    import { cn } from \"$UTILS$\";\r\n    import type { HTMLImgAttributes } from \"svelte/elements\";\r\n    import { onMount } from \"svelte\";\r\n\r\n    type Props = HTMLImgAttributes & {\r\n        class?: string;\r\n    };\r\n\r\n    let { src, alt, class: className, ...rest }: Props = $props();\r\n\r\n    const { registerImage, openImage } = getImageZoomContext();\r\n\r\n    let myIndex: number; // This trigger's unique index\r\n\r\n    onMount(() => {\r\n        if (!src) {\r\n            console.warn(\"ImageZoom.Trigger requires a 'src' prop.\");\r\n            return;\r\n        }\r\n        myIndex = registerImage({ src, alt: alt || '' });\r\n    });\r\n\r\n    function handleOpenZoom() {\r\n        if (myIndex !== undefined) {\r\n            openImage(myIndex);\r\n        }\r\n    }\r\n</script>\r\n\r\n<img\r\n        src={src || ''}\r\n        alt={alt || ''}\r\n        class={cn(\r\n        \"cursor-zoom-in transition-transform duration-200 hover:scale-[1.01] hover:brightness-90\",\r\n        className\r\n    )}\r\n        onclick={handleOpenZoom}\r\n        {...rest}\r\n/>",
			"type": "registry:ui",
			"target": "image-zoom/image-zoom-trigger.svelte"
		},
		{
			"content": "import { getContext, setContext } from \"svelte\";\r\nimport type { Writable } from \"svelte/store\";\r\n\r\nconst IMAGE_ZOOM_KEY = Symbol(\"image-zoom\");\r\n\r\nexport type ZoomImageData = {\r\n    src: string;\r\n    alt: string;\r\n    index: number; // Will be assigned by root\r\n};\r\n\r\ntype ImageZoomContext = {\r\n    currentImageIndex: Writable<number | null>;\r\n    open: Writable<boolean>;\r\n\r\n    registerImage: (imageData: Omit<ZoomImageData, 'index'>) => number;\r\n    openImage: (index: number) => void;\r\n\r\n    nextImage: () => void;\r\n    prevImage: () => void;\r\n\r\n    registeredImages: Writable<ZoomImageData[]>;\r\n};\r\n\r\nexport function setImageZoomContext(ctx: ImageZoomContext) {\r\n    setContext(IMAGE_ZOOM_KEY, ctx);\r\n}\r\n\r\nexport function getImageZoomContext() {\r\n    const ctx = getContext<ImageZoomContext>(IMAGE_ZOOM_KEY);\r\n    if (!ctx) {\r\n        throw new Error(\"ImageZoom.Trigger must be used inside an ImageZoom.Root\");\r\n    }\r\n    return ctx;\r\n}",
			"type": "registry:ui",
			"target": "image-zoom/ctx.ts"
		},
		{
			"content": "import Root from \"./image-zoom.svelte\";\r\nimport Trigger from \"./image-zoom-trigger.svelte\";\r\n\r\nexport {\r\n    Root,\r\n    Trigger\r\n};",
			"type": "registry:ui",
			"target": "image-zoom/index.ts"
		}
	]
}